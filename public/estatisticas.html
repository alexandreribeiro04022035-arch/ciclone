<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estatísticas - CICLONE PTC</title>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Segoe UI', Arial, sans-serif;
    }

    body {
        background: linear-gradient(135deg, #1a1a2e, #16213e);
        color: white;
        min-height: 100vh;
        padding: 20px;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 20px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .header {
        text-align: center;
        padding: 20px;
        margin-bottom: 20px;
        border-bottom: 2px solid rgba(255, 255, 255, 0.1);
    }

    .header h1 {
        font-size: 2.5rem;
        color: #4fc3f7;
        margin-bottom: 10px;
    }

    .top-section {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        background: rgba(255, 255, 255, 0.08);
        border-radius: 10px;
        margin-bottom: 30px;
    }

    .text-section {
        flex: 3;
        padding-right: 30px;
    }

    .text-section h2 {
        color: #4fc3f7;
        font-size: 1.8rem;
        margin-bottom: 15px;
    }

    .text-section p {
        color: rgba(255, 255, 255, 0.8);
        line-height: 1.6;
        margin-bottom: 10px;
    }

    .logo-section {
        flex: 1;
        text-align: center;
    }

    .logo-section img {
        width: 150px;
        height: 150px;
        border-radius: 10px;
        object-fit: cover;
        border: 3px solid #4fc3f7;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        margin-bottom: 20px;
    }

    .stat-row {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-left: 5px solid #4fc3f7;
    }

    .stat-label {
        font-size: 1.1rem;
        color: rgba(255, 255, 255, 0.9);
    }

    .stat-value {
        font-size: 2rem;
        font-weight: bold;
        color: #4fc3f7;
    }

    .stat-source {
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.6);
        margin-top: 5px;
        display: block;
    }

    .footer {
        text-align: center;
        padding: 20px;
        margin-top: 30px;
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.9rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .footer a {
        color: #4fc3f7;
        text-decoration: none;
        margin: 0 10px;
    }

    @media (max-width: 768px) {
        .top-section {
            flex-direction: column;
            text-align: center;
        }
        
        .text-section {
            padding-right: 0;
            margin-bottom: 20px;
        }
        
        .stats-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>CICLONE PTC - ESTATÍSTICAS</h1>
    </div>

    <div class="top-section">
        <div class="text-section">
            <h2>PLATAFORMA PTC CICLONE</h2>
            <p>Sistema brasileiro de anúncios pagos. Distribuição começa pelo menor ID.</p>
            <p>Estatísticas atualizadas em tempo real diretamente do banco de dados.</p>
        </div>
        
        <div class="logo-section">
            <img src="https://images.unsplash.com/photo-1551288049-bebda4e38f71?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80" alt="Logo CICLONE">
        </div>
    </div>

    <div class="stats-grid" id="statsGrid">
        <!-- Os dados serão carregados aqui via JavaScript -->
    </div>

    <div class="footer">
        <p>CICLONE PTC © 2024 - Estatísticas em tempo real</p>
        <p style="margin-top: 10px;">
            <a href="index.html">Página Inicial</a> | 
            <a href="login-top.html">Login</a> | 
            <a href="register.html">Registrar</a>
        </p>
    </div>
</div>

<script>
// Função para formatar números
function formatNumber(num) {
    if (num === null || num === undefined) return '0';
    return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}

// Função para formatar dinheiro
function formatMoney(value) {
    if (value === null || value === undefined) return 'R$ 0,00';
    return 'R$ ' + parseFloat(value).toFixed(2).replace('.', ',');
}

// Função principal para carregar estatísticas
async function carregarEstatisticas() {
    try {
        // Busca dados da API
        const resposta = await fetch('https://ciclone-62mq.onrender.com/api/estatisticas');
        const dados = await resposta.json();
        
        if (dados.success) {
            atualizarInterface(dados);
        }
    } catch (erro) {
        console.log('Erro ao carregar estatísticas:', erro);
        // Mostra dados zerados se a API falhar
        mostrarDadosZerados();
    }
}

// Atualiza a interface com dados reais
function atualizarInterface(dados) {
    const statsGrid = document.getElementById('statsGrid');
    
    statsGrid.innerHTML = `
        <div class="stat-row">
            <div>
                <span class="stat-label">USUÁRIOS</span>
                <span class="stat-source">(da tabela cadastro)</span>
            </div>
            <div class="stat-value">${formatNumber(dados.total_usuarios)}</div>
        </div>
        
        <div class="stat-row">
            <div>
                <span class="stat-label">CLICKS</span>
                <span class="stat-source">(da tabela clicks)</span>
            </div>
            <div class="stat-value">${formatNumber(dados.total_clicks)}</div>
        </div>
        
        <div class="stat-row">
            <div>
                <span class="stat-label">ANÚNCIOS</span>
                <span class="stat-source">(da tabela anuncios)</span>
            </div>
            <div class="stat-value">${formatNumber(dados.total_anuncios)}</div>
        </div>
        
        <div class="stat-row">
            <div>
                <span class="stat-label">AVALIAÇÕES</span>
                <span class="stat-source">(da tabela avaliacoes)</span>
            </div>
            <div class="stat-value">${formatNumber(dados.total_avaliacoes)}</div>
        </div>
        
        <div class="stat-row" style="grid-column: 1 / span 2;">
            <div>
                <span class="stat-label">SALDO TOTAL DA PLATAFORMA</span>
                <span class="stat-source">(soma dos saldos da tabela cadastro)</span>
            </div>
            <div class="stat-value">${formatMoney(dados.saldo_total)}</div>
        </div>
        
        <div class="stat-row" style="grid-column: 1 / span 2;">
            <div>
                <span class="stat-label">PRÓXIMO A RECEBER</span>
                <span class="stat-source">(menor ID com saldo pendente)</span>
            </div>
            <div class="stat-value">ID ${dados.proximo_recebedor.id} (${formatMoney(dados.proximo_recebedor.saldo)})</div>
        </div>
    `;
}

// Mostra dados zerados (fallback)
function mostrarDadosZerados() {
    const statsGrid = document.getElementById('statsGrid');
    
    statsGrid.innerHTML = `
        <div class="stat-row">
            <div>
                <span class="stat-label">USUÁRIOS</span>
                <span class="stat-source">(da tabela cadastro)</span>
            </div>
            <div class="stat-value">0</div>
        </div>
        
        <div class="stat-row">
            <div>
                <span class="stat-label">CLICKS</span>
                <span class="stat-source">(da tabela clicks)</span>
            </div>
            <div class="stat-value">0</div>
        </div>
        
        <div class="stat-row">
            <div>
                <span class="stat-label">ANÚNCIOS</span>
                <span class="stat-source">(da tabela anuncios)</span>
            </div>
            <div class="stat-value">0</div>
        </div>
        
        <div class="stat-row">
            <div>
                <span class="stat-label">AVALIAÇÕES</span>
                <span class="stat-source">(da tabela avaliacoes)</span>
            </div>
            <div class="stat-value">0</div>
        </div>
        
        <div class="stat-row" style="grid-column: 1 / span 2;">
            <div>
                <span class="stat-label">SALDO TOTAL DA PLATAFORMA</span>
                <span class="stat-source">(soma dos saldos da tabela cadastro)</span>
            </div>
            <div class="stat-value">R$ 0,00</div>
        </div>
        
        <div class="stat-row" style="grid-column: 1 / span 2;">
            <div>
                <span class="stat-label">PRÓXIMO A RECEBER</span>
                <span class="stat-source">(menor ID com saldo pendente)</span>
            </div>
            <div class="stat-value">Nenhum</div>
        </div>
    `;
}

// Rota no server.js para fornecer os dados
async function criarRotaEstatisticas() {
    // Esta função seria no backend (server.js)
    console.log(`Rota para adicionar no server.js:
    
app.get('/api/estatisticas', async (req, res) => {
  try {
    // 1. Total de usuários
    const usuarios = await pool.query('SELECT COUNT(*) as total FROM cadastro');
    
    // 2. Total de clicks
    const clicks = await pool.query('SELECT SUM(total_clicks) as total FROM clicks');
    
    // 3. Total de anúncios ativos
    const anuncios = await pool.query('SELECT COUNT(*) as total FROM anuncios WHERE ativo = true');
    
    // 4. Total de avaliações
    const avaliacoes = await pool.query('SELECT COUNT(*) as total FROM avaliacoes');
    
    // 5. Saldo total da plataforma
    const saldo = await pool.query('SELECT SUM(saldo_redisponivel) as total FROM cadastro');
    
    // 6. Próximo a receber (menor ID com saldo)
    const proximo = await pool.query(
      'SELECT id, saldo_redisponivel FROM cadastro WHERE saldo_redisponivel > 0 ORDER BY id ASC LIMIT 1'
    );

    res.json({
      success: true,
      total_usuarios: usuarios.rows[0].total || 0,
      total_clicks: clicks.rows[0].total || 0,
      total_anuncios: anuncios.rows[0].total || 0,
      total_avaliacoes: avaliacoes.rows[0].total || 0,
      saldo_total: saldo.rows[0].total || 0,
      proximo_recebedor: proximo.rows[0] || { id: 0, saldo: 0 }
    });
    
  } catch (error) {
    res.json({ success: false, error: error.message });
  }
});`);
}

// Carregar estatísticas ao abrir a página
carregarEstatisticas();

// Atualizar a cada 30 segundos
setInterval(carregarEstatisticas, 30000);

// Mostra o código da rota no console (para você copiar)
criarRotaEstatisticas();
</script>
</body>
</html>
